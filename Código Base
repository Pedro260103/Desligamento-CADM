Sub SEFIP()
    Dim LocaldoArquivo As String
    Dim NumArquivo As Integer
    Dim FileContent As String
    Dim Linha As String
     
    
    LocaldoArquivo = "C:\Users\pres00314250\Desktop\arquivo_aprender.txt"
    NumArquivo = FreeFile
    
    Open LocaldoArquivo For Input As #NumArquivo ' Abre o arquivo em modo de leitura
    
    FileContent = Input$(LOF(1), #NumArquivo)
    Close #NumArquivo
 
    ' Extrai informações da linha
    Linha = Trim(FileContent) ' Remove espaços em branco no início e no fim
 
    Dim Codigo As String
    Dim Pis As String
    Dim nome As String
    Dim DataAdimissao As String
    Dim Codigo20 As String
    Dim CodigoDesligamento As String
    Dim bm As String
    Dim DataNacimento As String
    Dim DataDemissao As String
    Dim NovoConteudo As String
    Dim linhas() As String
    Dim UltimaLinha As Integer ' longlong
    Dim contador As LongLong
    contador = 2
    linhas = Split(FileContent, vbCrLf)
    UltimaLinha = UBound(linhas)
    
    
    Do While Range("A" & contador).Value <> ""
        bm = Range("A" & contador).Value
        bm = Replace(bm, "-", "")
        
        For i = 3 To UltimaLinha
        Codigo = Mid(linhas(i), 1, 18)
        Pis = Mid(linhas(i), 33, 11) ' Ajuste para 11 caracteres
        nome = Mid(linhas(i), 54, 70) ' Ajuste para 30 caracteres
        DataAdmissao = Mid(linhas(i), 44, 8) ' Extrai a DataAdmissao corretamente
        Codigo20 = Mid(linhas(i), 48, 2)
        DataDemissao = Range("D" & contador).Value
        DataDemissao = Replace(DataDemissao, "/", "")
        CodigoDesligamento = MotivoDesligamentoCodigo(DataDemissao, contador) 'MotivoDesligamentoCodigo(DataDemissao, contador)
        DataNacimento = Mid(linhas(i), 155, 8)
        Codigo = Left(Codigo, 1) & "2" & Right(Codigo, Len(Codigo) - 2)
        
        If InStr(1, linhas(i), bm, vbTextCompare) > 0 Then 'And CodigosNullosDesligamento(linhas, i + 1) = True Then
        
        
            MsgBox "Valor encontrado na posição " & i
      
            
            ' Exibe as informações extraídas
            MsgBox "Código: " & Codigo & vbCrLf & "Pis: " & Pis & vbCrLf & "Nome: " & nome & vbCrLf & "DataAdmissao: " & DataAdmissao & vbCrLf & "DataDemissao: " & DataDemissao & vbCrLf & "Codigo20: " & Codigo20 & vbCrLf & "BM: " & bm & vbCrLf & "DataNacimento: " & DataNacimento
    
            ' Crie o novo conteúdo com as informações modificadas
            NovoConteudo = Codigo & Space(14) & Mid(Pis & Space(11), 1, 11) & Mid(DataAdmissao & Space(8), 1, 8) & Codigo20 & Mid(nome & Space(70), 1, 70) & Mid(CodigoDesligamento, 1, 11) & Space(225) & "*"
 'Se BM = Médio (Linha, 124, 11) então
            'NovoConteudo = Linha & vbCrLf & NovoConteudo
  
          
            Dim OriginalConteudo As String
            OriginalConteudo = linhas(i)
            Dim i2 As Integer
            i2 = UltimaLinha
            ReDim Preserve linhas(UBound(linhas))
            linhas(UBound(linhas)) = "                                                                                                                                                                                                                                                                                                                                                                        "
            'Dim c As Integer
            'c = 1
 
                ' Adiciona uma linha em branco ao final do array
                Dim umaVez As Integer
                umaVez = 0
            Do While i2 >= i 'InStr(1, linhas(i2), nome, vbTextCompare) = 0
                
                Dim PisTXT As String
                PisTXT = Mid(linhas(i2 - 1), 33, 11)
                If PisTXT = Pis And umaVez = 0 Then
                    linhas(i2) = NovoConteudo
                    umaVez = umaVez + 1
                    i2 = i - 1
                Else
                    linhas(i2) = linhas(i2 - 1)
                    i2 = i2 - 1
                            
                End If
                    
                    
            Loop
            
 'linhas(i - 1) = OriginalConteúdo
                
            ' Reescreve o arquivo com o conteúdo atualizado
            Open LocaldoArquivo For Output As #NumArquivo
            Print #NumArquivo, Join(linhas, vbCrLf) ' Converte o array de volta para uma única string com linhas separadas por vbCrLf
            Close #NumArquivo
            
    
    
    
 ' Substitui a linha anterior pelo NovoConteúdo
            'FileContent = Replace(FileContent, linhas(i), NovoConteudo)
            ' Abre o arquivo em modo de adição (Append) para adicionar o novo conteúdo ao final do arquivo
            'Open LocaldoArquivo For Append As #NumArquivo 'Append
            'Print #NumArquivo, NovoConteudo
            'Close #NumArquivo
     
            
                
            contador = contador + 1 ' para na planilha passar para o BM de baixo
            'If i > 1 Then
              'i = 3
            'End If
             
             
            'ElseIf CodigosNullosDesligamento(linhas, i + 1) = False Then ' Acho que não precisa do else
            
            
             
            i = UltimaLinha
            
        End If
     
     Next i
 Loop

End Sub





























'demanda urgente


Sub grava()
 Dim LocalDoArquivo como sequência de caracteres
 Dim NumArquivo como inteiro
 Dim FileContent como cadeia de caracteres
    Dim Linha As String
    LocalDoArquivo = "C:\Users\pres00314250\Desktop\arquivo_aprender.txt"
    NumArquivo = FreeFile
    
 Abra LocalDoArquivo para entrada como #NumArquivo

    FileContent = Input$(LOF(1), #NumArquivo)
 Fechar #NumArquivo
    
    
    Linha = Trim(FileContent)
    
 Dim SegundaInfo Como String
    Dim Nome As String
 Dim NomeFlutuante Como String
 Dim BM como corda
 Dim eUmBM como corda
 Dim NovoConteudo Como Corda
 Dim PrimeiraInfo Como String
    Dim linhas() As String
    Dim MudaPessoa As LongLong
    MudaPessoa = 0
 Dim puladas como LongLong
    puladas = 0
    linhas = Split(FileContent, vbCrLf)
    
    
    
    
    
    Dim contador As Integer
    contador = 1
 Para i = 3 a 9510 'UBound(linhas)
 Nome = Médio(linhas(i), 54, 70)
 BM = Médio (linhas(i), 124, 11)
 eUmBM = Médio (linhas(i), 124, 2)
        
 If InStr(1, linhas(i), eUmBM, vbTextCompare) > 0 E eUmBM = "00" Então ' ficou meio redundante
            puladas = puladas + 1
 Se InStr(1, linhas(i + 1), eUmBM, vbTextCompare) <> BM então
                MudaPessoa = MudaPessoa + 1
                contador = 1
 Fim Se
            
            
 Mais
            
 NomeFlutuante = Médio(linhas(i + 1), 54, 70)
 Se eUmBM = "I3" ou eUmBM = "I1" ou eUmBM = " J" Então
                
 « MsgBox "Achamos o I3N , I1N , J"
                PrimeiraInfo = Mid(linhas(i - contador), 1, 244)
                SegundaInfo = Mid(linhas(i - contador), 245, 116)
 « MsgBox SegundaInfo
 SegundaInfo = Esquerda(SegundaInfo, 1) & "1" & Direita(SegundaInfo, Len(SegundaInfo) - 2)
 NovoConteúdo = PrimeiraInfo + SegundaInfo
 « MsgBox NovoConteudo
                ' Abre o arquivo em modo de leitura e escrita
 Abra LocalDoArquivo para entrada como #NumArquivo
                FileContent = Input$(LOF(1), #NumArquivo)
 Fechar #NumArquivo
                
 ' Substitui a linha anterior pelo NovoConteúdo
                FileContent = Replace(FileContent, linhas(i - contador), NovoConteudo)
                
                ' Abre o arquivo em modo de escrita para gravar as alterações
 Abra LocalDoArquivo para saída como #NumArquivo
 Imprimir #NumArquivo, FileContent
 Fechar #NumArquivo
                contador = 1
 Mais
            
            
            
            contador = contador + 1
            
            
            
 Fim Se
                
            
            
            
            
 Fim Se
    
 Seguinte i
    
MsgBox "Fim!"
Subfinal
