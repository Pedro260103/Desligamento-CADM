Sub SEFIP()
    Dim LocaldoArquivo As String
    Dim NumArquivo As Integer
    Dim FileContent As String
    Dim Linha As String
     
    
    LocaldoArquivo = "C:\Users\pres00314250\Desktop\arquivo_aprender.txt"
    NumArquivo = FreeFile
    
 Open FileLocation For Input As #NumArquivo ' Opens the file in read mode
    
    FileContent = Input$(LOF(1), #NumArquivo)
    Close #NumArquivo
 
 ' Extracts information from the line
 Line = Trim(FileContent) ' Removes whitespace at the beginning and end
 
 Dim Code As String
    Dim Pis As String
    Dim nome As String
    Dim DataAdimissao As String
    Dim Codigo20 As String
    Dim CodigoDesligamento As String
    Dim bm As String
    Dim DataNacimento As String
    Dim DataDemissao As String
    Dim NovoConteudo As String
    Dim linhas() As String
    Dim UltimaLinha As Integer ' longlong
    Dim contador As LongLong
    contador = 2
    linhas = Split(FileContent, vbCrLf)
    UltimaLinha = UBound(linhas)
    
    
    
 Do While Range("A" & contador). Value <> ""
 bm = Range("A" & contador). Value
        bm = Replace(bm, "-", "")
        bm = Replace(bm, "X", "0")
        
        For i = 3 To UltimaLinha
 Code = Mid(lines(i), 1, 18)
 Pis = Mid(lines(i), 33, 11) ' Adjustment to 11 characters
 name = Mid(lines(i), 54, 70) ' Adjustment to 30 characters
 Admission Date = Mid(rows(i), 44, 8) ' Extracts the Admission Date correctly
        Codigo20 = Mid(linhas(i), 48, 2)
 DataDemissao = Range("D" & contador). Value
        DataDemissao = Replace(DataDemissao, "/", "")
        CodigoDesligamento = MotivoDesligamentoCodigo(DataDemissao, contador) 'MotivoDesligamentoCodigo(DataDemissao, contador)
        DataNacimento = Mid(linhas(i), 155, 8)
 Code = Left(Code, 1) & "2" & Right(Code, Len(Code) - 2)
        
        If InStr(1, linhas(i), bm, vbTextCompare) > 0 And InStr(1, linhas(i), nome, vbTextCompare) > 0 Then
        
        
 MsgBox "Value found in position " & i
      
            
 ' Displays the extracted information
            MsgBox "Código: " & Codigo & vbCrLf & "Pis: " & Pis & vbCrLf & "Nome: " & nome & vbCrLf & "DataAdmissao: " & DataAdmissao & vbCrLf & "DataDemissao: " & DataDemissao & vbCrLf & "Codigo20: " & Codigo20 & vbCrLf & "BM: " & bm & vbCrLf & "DataNacimento: " & DataNacimento
    
 ' Create the new content with the modified information
            NovoConteudo = Codigo & Space(14) & Mid(Pis & Space(11), 1, 11) & Mid(DataAdmissao & Space(8), 1, 8) & Codigo20 & Mid(nome & Space(70), 1, 70) & Mid(CodigoDesligamento, 1, 11) & Space(225) & "*"
 
          
            Dim OriginalConteudo As String
 OriginalContent = lines(i)
            Dim i2 As Integer
            i2 = UltimaLinha
            ReDim Preserve linhas(UBound(linhas))
 lines(UBound(lines)) = " "
            
 ' Adds a blank line to the end of the array
                Dim umaVez As Integer
                umaVez = 0
 Do While i2 >= i 'InStr(1, lines(i2), name, vbTextCompare) = 0
                
                Dim PisTXT As String
 PisTXT = Mid(lines(i2 - 1), 33, 11)
                'Dim bmCima As String
 'bmCima = Mid(lines(i2 - 1), 127, 8)
                If PisTXT = Pis And umaVez = 0 Then 'Or bmCima = bm Then
 lines(i2) = NewContent
                    umaVez = umaVez + 1
                    i2 = i - 1
                Else
 Lines(i2) = lines(I2 - 1)
                    i2 = i2 - 1
                            
                End If
                    
                    
            Loop
            
 'lines(i - 1) = OriginalContent
                
 ' Rewrites the file with the updated content
            Open LocaldoArquivo For Output As #NumArquivo
 Print #NumArquivo, Join(lines, vbCrLf) ' Converts the array back to a single string with lines separated by vbCrLf
            Close #NumArquivo
            
    
                
 counter = counter + 1' for in the worksheet to move to the bottom BM
            
             
            i = UltimaLinha
            Else
                If i = UltimaLinha Then
 MsgBox "Not Found : " & name & " " & bm
                    'i = UltimaLinha
 Range("A" & contador). Interior.Color = vbRed
                    contador = contador + 1
                End If
            
        End If
     
     Next i
     
 Loop

End Sub
























'urgent demand


Sub grava()
 Dim FileLocation as string
 Dim NumFile as integer
 Dim FileContent as string
    Dim Linha As String
    LocalDoArquivo = "C:\Users\pres00314250\Desktop\arquivo_aprender.txt"
    NumArquivo = FreeFile
    
 Open LocalDoArquivo for entry as #NumArquivo

    FileContent = Input$(LOF(1), #NumArquivo)
 Close #NumArquivo
    
    
 Line = Trim(FileContent)
    
 Dim SegundaInfo Como String
    Dim Nome As String
 Dim NomeFlutuante Como String
 Dim BM as rope
 Dim eUmBM as string
 Dim NovoConteudo as Corda
 Dim PrimeiraInfo Como String
    Dim linhas() As String
    Dim MudaPessoa As LongLong
    MudaPessoa = 0
 Dim puladas como LongLong
    puladas = 0
    linhas = Split(FileContent, vbCrLf)
    
    
    
    
    
    Dim contador As Integer
    contador = 1
 Para i = 3 a 9510 'UBound(linhas)
 Nome = Médio(linhas(i), 54, 70)
 BM = Médio (linhas(i), 124, 11)
 eUmBM = Médio (linhas(i), 124, 2)
        
 If InStr(1, linhas(i), eUmBM, vbTextCompare) > 0 E eUmBM = "00" Então ' ficou meio redundante
            puladas = puladas + 1
 Se InStr(1, linhas(i + 1), eUmBM, vbTextCompare) <> BM então
                MudaPessoa = MudaPessoa + 1
                contador = 1
 Fim Se
            
            
 Mais
            
 NomeFlutuante = Médio(linhas(i + 1), 54, 70)
 Se eUmBM = "I3" ou eUmBM = "I1" ou eUmBM = " J" Então
                
 « MsgBox "Achamos o I3N , I1N , J"
                PrimeiraInfo = Mid(linhas(i - contador), 1, 244)
                SegundaInfo = Mid(linhas(i - contador), 245, 116)
 « MsgBox SegundaInfo
 SegundaInfo = Esquerda(SegundaInfo, 1) & "1" & Direita(SegundaInfo, Len(SegundaInfo) - 2)
 NovoConteúdo = PrimeiraInfo + SegundaInfo
 « MsgBox NovoConteudo
                ' Abre o arquivo em modo de leitura e escrita
 Abra LocalDoArquivo para entrada como #NumArquivo
                FileContent = Input$(LOF(1), #NumArquivo)
 Fechar #NumArquivo
                
 ' Substitui a linha anterior pelo NovoConteúdo
                FileContent = Replace(FileContent, linhas(i - contador), NovoConteudo)
                
                ' Abre o arquivo em modo de escrita para gravar as alterações
 Abra LocalDoArquivo para saída como #NumArquivo
 Imprimir #NumArquivo, FileContent
 Fechar #NumArquivo
                contador = 1
 Mais
            
            
            
            contador = contador + 1
            
            
            
 Fim Se
                
            
            
            
            
 Fim Se
    
 Seguinte i
    
MsgBox "Fim!"
Subfinal
